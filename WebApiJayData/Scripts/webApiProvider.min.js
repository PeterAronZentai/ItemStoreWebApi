$C("$data.Expressions.ExpressionWalker",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(n){this.Visit=function(t,i){var r=t,u,f,e;return this.canVisit(t)&&(n.VisitExpressionNode&&n.VisitExpressionNode.apply(n,arguments),u="Visit"+t.getType().name,u in n&&(r=n[u].apply(n,arguments))),f=arguments,r!==t&&(f=[r,i]),r=$data.Expressions.EntityExpressionVisitor.prototype.Visit.apply(this,f),f=[r,i],this.canVisit(r)&&(e=r.getType().name,n.MonitorExpressionNode&&n.MonitorExpressionNode.apply(n,f),u="Monitor"+e,u in n&&n[u].apply(n,f),n.MutateExpressionNode&&n.MutateExpressionNode.apply(n,f),u="Mutate"+e,u in n&&(r=n[u].apply(n,f))),r}}}),$data.Expressions.ExpressionNode.prototype.walk=function(n,t){var i=Container.createExpressionWalker(n);return i.Visit(this,t)},$data.Expressions.ExpressionNode.prototype.dig=function(n){var t=[];return this.walk({MonitorExpressionNode:function(i){var r;(r=n(i))&&t.push(r)}}),t},$C("$data.storageProviders.WebApiProvider",$data.StorageProviderBase,null,{constructor:function(n,t){this.context=t,this.providerConfiguration=$data.typeSystem.extend({dbCreation:$data.storageProviders.DbCreationType.DropTableIfChanged,apiUrl:"/odata.svc",serviceUrl:"",maxDataServiceVersion:"2.0",user:null,password:null,withCredentials:!1,enableJSONP:!1},n),this.context&&this.context._buildDbType_generateConvertToFunction&&this.buildDbType_generateConvertToFunction&&(this.context._buildDbType_generateConvertToFunction=this.buildDbType_generateConvertToFunction),this.context&&this.context._buildDbType_modifyInstanceDefinition&&this.buildDbType_modifyInstanceDefinition&&(this.context._buildDbType_modifyInstanceDefinition=this.buildDbType_modifyInstanceDefinition)},initializeStore:function(n){n=$data.typeSystem.createCallbackSetting(n),n.success(this.context)},buildDbType_generateConvertToFunction:function(n,t){return function(i,r){var u=new n.PhysicalType;return u.entityState=i.entityState,n.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(n){u[n.name]=i[n.name]},this),n.Associations&&n.Associations.forEach(function(n){var f,e;if((n.FromMultiplicity=="*"&&n.ToMultiplicity=="0..1"||n.FromMultiplicity=="0..1"&&n.ToMultiplicity=="1"||n.FromMultiplicity=="$$unbound")&&(f=i[n.FromPropertyName],f!==null&&f!==undefined))if(f instanceof $data.Array)u[n.FromPropertyName]=u[n.FromPropertyName]||[],f.forEach(function(t){var i=r.indexOf(t);i<0&&Guard.raise("Dependency graph error"),u[n.FromPropertyName].push({__metadata:{uri:"$"+(i+1)}})},this);else if(f.entityState===$data.EntityState.Modified){var o=t._storageModel.getStorageModel(f.getType()),s=o.TableName,h="("+t.storageProvider.getEntityKeysValue({data:f,entitySet:o.EntitySetReference})+")";u[n.FromPropertyName]={__metadata:{uri:s+h}}}else e=r.indexOf(f),e<0&&Guard.raise("Dependency graph error"),u[n.FromPropertyName]={__metadata:{uri:"$"+(e+1)}}},this),n.ComplexTypes&&n.ComplexTypes.forEach(function(n){u[n.FromPropertyName]=i[n.FromPropertyName]},this),u}},executeQuery:function(n,t){function e(n){var t=$data.Expressions,r=0,u=n.expression.dig(function(i){if(i instanceof t.SimpleBinaryExpression&&r++,i.nodeType=="equal"){var f=null,u=null;if(i.left instanceof t.ConstantExpression&&(f=i.left),i.left instanceof t.EntityFieldExpression&&(u=i.left),i.right instanceof t.ConstantExpression&&(f=i.right),i.right instanceof t.EntityFieldExpression&&(u=i.right),u&&f&&u.source.entityType===n.defaultType&&u.selector.memberName==n.defaultType.memberDefinitions.getKeyProperties()[0].name)return f.value}});r==1&&u.length==1&&(i.queryText="/"+n.context.getEntitySetFromElementType(n.defaultType).tableName+"/"+u[0].toString())}var i,f,r;t=$data.typeSystem.createCallbackSetting(t);try{i=this._compile(n)}catch(u){t.error(u);return}f=this.context,e(n),r={url:this.providerConfiguration.apiUrl+i.queryText,type:i.method,success:function(i){t.success&&(n.rawDataList=typeof i=="string"?[{cnt:i}]:i,t.success(n))},error:function(){callback.error(arguments)}},this.appendBasicAuth(r,this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,r),$data.ajax(r)},_compile:function(n){var t=new $data.storageProviders.webApi.webApiCompiler;return t.compile(n)},saveChanges:function(n,t){if(t.length>0){var i=this.buildIndependentBlocks(t);this.saveInternal(i,0,n)}else n.success(0)},saveInternal:function(n,t,i){n.length>1||n.length==1&&n[0].length>1?this._saveBatch(n,t,i):this._saveRest(n,t,i)},_saveRest:function(n,t,i){for(var e=[],r,f,o,u=0;u<n.length;u++)for(f=0;f<n[u].length;f++){e.push(n[u][f].data),r={url:this.providerConfiguration.apiUrl+"/",headers:{},contentType:"application/json",dataType:"json"};switch(n[u][f].data.entityState){case $data.EntityState.Unchanged:continue;case $data.EntityState.Added:r.type="POST",r.url+=n[u][f].entitySet.name,r.data=this.save_getInitData(n[u][f],e);break;case $data.EntityState.Modified:r.type="PUT",r.url+=n[u][f].entitySet.name,r.url+="/"+this.getEntityKeysValue(n[u][f]),this.save_addConcurrencyHeader(n[u][f],r.headers),r.data=this.save_getInitData(n[u][f],e);break;case $data.EntityState.Deleted:r.type="DELETE",r.url+=n[u][f].entitySet.name,r.url+="/"+this.getEntityKeysValue(n[u][f]),this.save_addConcurrencyHeader(n[u][f],r.headers);break;default:Guard.raise(new Exception("Not supported Entity state"))}r.data&&(r.data=JSON.stringify(r.data))}o=this,r.success=function(n,t,r){var s=arguments,f=r.status,u;f>=200&&f<300?(n&&(u=e[0],u.getType().memberDefinitions.getPublicMappedProperties().forEach(function(t){var r=Container.resolveType(t.type),i;(t.computed||t.key||!r.isAssignableto&&!t.inverseProperty)&&(i=o.fieldConverter.fromDb[Container.resolveName(t.type)],u[t.name]=i?i(n[t.name]):n[t.name])},this)),i.success&&i.success(e.length)):i.error(response)},r.error=function(n){i.error(new Exception((n.response||{}).body,n.message,n))},this.appendBasicAuth(r,this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,r),$data.ajax(r)},_saveBatch:function(n,t,i){for(var s=[],e=[],f,u,h,o,r=0;r<n.length;r++)for(f=0;f<n[r].length;f++){e.push(n[r][f].data),u={},u.headers={"Content-Id":e.length};switch(n[r][f].data.entityState){case $data.EntityState.Unchanged:continue;case $data.EntityState.Added:u.method="POST",u.requestUri=n[r][f].entitySet.name,u.data=this.save_getInitData(n[r][f],e);break;case $data.EntityState.Modified:u.method="MERGE",u.requestUri=n[r][f].entitySet.name,u.requestUri+="("+this.getEntityKeysValue(n[r][f])+")",this.save_addConcurrencyHeader(n[r][f],u.headers),u.data=this.save_getInitData(n[r][f],e);break;case $data.EntityState.Deleted:u.method="DELETE",u.requestUri=n[r][f].entitySet.name,u.requestUri+="("+this.getEntityKeysValue(n[r][f])+")",this.save_addConcurrencyHeader(n[r][f],u.headers);break;default:Guard.raise(new Exception("Not supported Entity state"))}s.push(u)}h=this,o=[{requestUri:this.providerConfiguration.apiUrl+"/$batch",method:"POST",data:{__batchRequests:[{__changeRequests:s}]}},function(n,t){var u,o,r,f,s;if(t.statusCode==202){for(u=n.__batchResponses[0].__changeResponses,o=[],r=0;r<u.length;r++)if(u[r].statusCode>200&&u[r].statusCode<300){if(f=e[r],u[r].statusCode==204){(u[r].headers.ETag||u[r].headers.Etag)&&(s=f.getType().memberDefinitions.getPublicMappedProperties().filter(function(n){return n.concurrencyMode===$data.ConcurrencyMode.Fixed}),s&&s[0]&&(f[s[0].name]=u[r].headers.ETag||u[r].headers.Etag));continue}f.getType().memberDefinitions.getPublicMappedProperties().forEach(function(n){if(n.computed||n.key)if(n.concurrencyMode===$data.ConcurrencyMode.Fixed)f[n.name]=u[r].headers.ETag||u[r].headers.Etag;else{var t=h.fieldConverter.fromDb[Container.resolveType(n.type)];f[n.name]=t?t(u[r].data[n.name]):u[r].data[n.name]}},this)}else o.push(new Exception((u[r].response||{}).body,u[r].message,u[r]));o.length>0?i.error(new Exception("See inner exceptions","Batch failed",o)):i.success&&i.success(e.length)}else i.error(t)},function(n){i.error(new Exception((n.response||{}).body,n.message,n))},OData.batchHandler],this.appendBasicAuth(o[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,o),OData.request.apply(this,o)},save_getInitData:function(n,t){n.physicalData=this.context._storageModel.getStorageModel(n.data.getType()).PhysicalType.convertTo(n.data,t);var i={};return n.physicalData.getType().memberDefinitions.asArray().forEach(function(t){t.kind!=$data.MemberTypes.navProperty&&t.kind!=$data.MemberTypes.complexProperty&&(t.kind!=$data.MemberTypes.property||t.notMapped)||(i[t.name]=n.physicalData[t.name])},this),i},save_addConcurrencyHeader:function(n,t){var i=n.data.getType().memberDefinitions.getPublicMappedProperties().filter(function(n){return n.concurrencyMode===$data.ConcurrencyMode.Fixed});i&&i[0]&&(t["If-Match"]=n.data[i[0].name])},getTraceString:function(n){var t=this._compile(n);return n},supportedDataTypes:{value:[$data.Integer,$data.String,$data.Number,$data.Blob,$data.Boolean,$data.Date,$data.Object,$data.Geography,$data.Guid],writable:!1},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqual:{mapTo:"ne",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},equalTyped:{mapTo:"eq",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqualTyped:{mapTo:"ne",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThan:{mapTo:"gt",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThanOrEqual:{mapTo:"ge",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThan:{mapTo:"lt",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThenOrEqual:{mapTo:"le",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},or:{mapTo:"or",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},and:{mapTo:"and",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},add:{mapTo:"add",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},divide:{mapTo:"div",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},multiply:{mapTo:"mul",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},subtract:{mapTo:"sub",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},modulo:{mapTo:"mod",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},"in":{mapTo:"in",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]}}},supportedUnaryOperators:{value:{not:{mapTo:"not"}}},supportedFieldOperations:{value:{contains:{mapTo:"substringof",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"substring",dataType:"string"},{name:"@expression"}]},startsWith:{mapTo:"startswith",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},endsWith:{mapTo:"endswith",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},length:{dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},strLength:{mapTo:"length",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},indexOf:{dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],mapTo:"indexof",baseIndex:1,parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},replace:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFrom",dataType:"string"},{name:"strTo",dataType:"string"}]},substr:{mapTo:"substring",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"startFrom",dataType:"number"},{name:"length",dataType:"number",optional:"true"}]},toLowerCase:{mapTo:"tolower",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},toUpperCase:{mapTo:"toupper",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},trim:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},concat:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},day:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},hour:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},minute:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},month:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},second:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},year:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},round:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},floor:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},ceiling:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]}},enumerable:!0,writable:!0},supportedSetOperations:{value:{filter:{},map:{},length:{},forEach:{},toArray:{},single:{},some:{invokable:!1,allowedIn:[$data.Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"any",frameType:$data.Expressions.SomeExpression},every:{invokable:!1,allowedIn:[$data.Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"all",frameType:$data.Expressions.EveryExpression},take:{},skip:{},orderBy:{},orderByDescending:{},first:{},include:{},batchDelete:{}},enumerable:!0,writable:!0},fieldConverter:{value:{fromDb:{"$data.Integer":function(n){return typeof n=="string"&&/^\d+$/.test(n)?parseInt(n):n},"$data.Number":function(n){return n},"$data.Date":function(n){return n?new Date(n):undefined},"$data.String":function(n){return n},"$data.Boolean":function(n){return n},"$data.Blob":function(n){return n},"$data.Object":function(n){return n===undefined?new $data.Object:typeof n=="string"?JSON.parse(n):n},"$data.Array":function(n){return n===undefined?new $data.Array:n instanceof $data.Array?n:JSON.parse(n)},"$data.Geography":function(n){return n&&typeof n=="object"&&Array.isArray(n.coordinates)?new $data.Geography(n.coordinates[0],n.coordinates[1]):n},"$data.Guid":function(n){return n?new $data.Guid(n):n}},toDb:{"$data.Entity":function(n){return"'"+JSON.stringify(n.initData)+"'"},"$data.Integer":function(n){return n},"$data.Number":function(n){return n%1==0?n:n+"m"},"$data.Date":function(n){return n?"datetime'"+n.toISOString()+"'":null},"$data.String":function(n){return"'"+n.replace(/'/g,"''")+"'"},"$data.Boolean":function(n){return n?"true":"false"},"$data.Blob":function(n){return n},"$data.Object":function(n){return JSON.stringify(n)},"$data.Array":function(n){return JSON.stringify(n)},"$data.Geography":function(n){return n instanceof $data.Geography?"POINT("+n.longitude+" "+n.latitude+")":n},"$data.Guid":function(n){return n?"guid'"+n.value+"'":n}}}},getEntityKeysValue:function(n){for(var u=[],t=undefined,e=n.entitySet.createNew.memberDefinitions.asArray(),r,f,i=0,o=e.length;i<o;i++)if(r=e[i],r.key){t=n.data[r.name];switch(Container.getName(r.dataType)){case"$data.Guid":case"Edm.Guid":t="guid'"+(t?t.value:t)+"'";break;case"$data.Blob":case"Edm.Binary":t="binary'"+t+"'";break;case"Edm.Byte":f="0123456789ABCDEF",t=f[i>>4&15]+f[i&15];break;case"$data.Date":case"Edm.DateTime":t="datetime'"+t.toISOString()+"'";break;case"Edm.Decimal":t=t+"M";break;case"Edm.Single":t=t+"f";break;case"Edm.Int64":t=t+"L";break;case"Edm.String":case"$data.String":t="'"+t+"'"}u.push(r.name+"="+t)}return u.length>1?u.join(","):t},appendBasicAuth:function(n,t,i,r){n.headers=n.headers||{},!n.headers.Authorization&&t&&i&&(n.headers.Authorization="Basic "+this.__encodeBase64(t+":"+i),n.withCredentials=r)},__encodeBase64:function(n){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f=n,h="",e,t,i="",c,l,o,r="",s=0;do e=f.charCodeAt(s++),t=f.charCodeAt(s++),i=f.charCodeAt(s++),c=e>>2,l=(e&3)<<4|t>>4,o=(t&15)<<2|i>>6,r=i&63,isNaN(t)?o=r=64:isNaN(i)&&(r=64),h=h+u.charAt(c)+u.charAt(l)+u.charAt(o)+u.charAt(r),e=t=i="",c=l=o=r="";while(s<f.length);return h}},null),$data.StorageProviderBase.registerProvider("webApi",$data.storageProviders.WebApiProvider),$C("$data.storageProviders.webApi.webApiCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(){this.context={},this.provider={},this.includes=null,this.mainEntitySet=null},compile:function(n){var i,f,r,u,t;this.provider=n.context.storageProvider,this.context=n.context,this.mainEntitySet=n.context.getEntitySetFromElementType(n.defaultType),i={urlText:""},this.Visit(n.expression,i),n.modelBinderConfig={},f=Container.createModelBinderConfigCompiler(n,this.includes,!0),f.Visit(n.expression),r=i.urlText,u=!1;for(t in i)t!="urlText"&&t!="actionPack"&&t!="data"&&t!="lambda"&&t!="method"&&i[t]!=""&&(r+=u?"&":"?",u=!0,r+=t!="$urlParams"?t+"="+i[t]:i[t]);return n.queryText=r,{queryText:r,method:i.method||"GET",params:[]}},VisitOrderExpression:function(n,t){this.Visit(n.source,t);var i=Container.createoDataOrderCompiler(this.provider);i.compile(n,t)},VisitPagingExpression:function(n,t){this.Visit(n.source,t);var i=Container.createoDataPagingCompiler();i.compile(n,t)},VisitIncludeExpression:function(n,t){var r,f;if(this.Visit(n.source,t),!t.$select){t.$expand?t.$expand+=",":t.$expand="",t.$expand+=n.selector.value.replace(/\./g,"/"),this.includes=this.includes||[];var u=n.selector.value.split("."),i=null,e=this.mainEntitySet.entityContext._storageModel.getStorageModel(this.mainEntitySet.createNew);for(r=0;r<u.length;r++)i?i+="."+u[r]:i=u[r],f=e.Associations[u[r]],f?this.includes.some(function(n){return n.name==i},this)||this.includes.push({name:i,type:f.ToType}):Guard.raise(new Exception("The given include path is invalid: "+n.selector.value+", invalid point: "+i)),e=this.mainEntitySet.entityContext._storageModel.getStorageModel(f.ToType)}},VisitProjectionExpression:function(n,t){this.Visit(n.source,t);var i=Container.createoDataProjectionCompiler(this.context);i.compile(n,t)},VisitFilterExpression:function(n,t){this.Visit(n.source,t);var i=Container.createoDataWhereCompiler(this.provider);t.data="",i.compile(n.selector,t),t.$filter=t.data,t.data=""},VisitEntitySetExpression:function(n,t){if(t.urlText+="/"+n.instance.tableName,n.params)for(var i=0;i<n.params.length;i++)this.Visit(n.params[i],t)},VisitServiceOperationExpression:function(n,t){if(t.urlText+="/"+n.cfg.serviceName,n.params)for(var i=0;i<n.params.length;i++)this.Visit(n.params[i],t)},VisitBatchDeleteExpression:function(n,t){this.Visit(n.source,t),t.urlText+="/$batchDelete",t.method="DELETE"},VisitConstantExpression:function(n,t){var i,r;t.$urlParams?t.$urlParams+="&":t.$urlParams="",n.value instanceof $data.Entity?i=this.provider.fieldConverter.toDb["$data.Entity"](n.value):(r=Container.getTypeName(n.value),i=this.provider.fieldConverter.toDb[Container.resolveName(Container.resolveType(r))](n.value)),t.$urlParams+=n.name+"="+i},VisitCountExpression:function(n,t){this.Visit(n.source,t),t.urlText+="/$count"}},{}),$C("$data.storageProviders.oData.oDataWhereCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(n,t){this.provider=n,this.lambdaPrefix=t},compile:function(n,t){this.Visit(n,t)},VisitParametricQueryExpression:function(n,t){this.Visit(n.expression,t)},VisitUnaryExpression:function(n,t){t.data+=n.resolution.mapTo,t.data+="(",this.Visit(n.operand,t),t.data+=")"},VisitSimpleBinaryExpression:function(n,t){var r,u;if(t.data+="(",n.nodeType=="in"){Guard.requireType("expression.right",n.type,$data.Expressions.ConstantExpression),r=n.right.value,!r instanceof Array&&Guard.raise(new Exception("Right to the 'in' operator must be an array value"));var i=null,f={mapTo:"or",dataType:"boolean",name:"or"},e={mapTo:"eq",dataType:"boolean",name:"equal"};r.forEach(function(t){var u=Container.createConstantExpression(t),r=Container.createSimpleBinaryExpression(n.left,u,$data.Expressions.ExpressionType.Equal,"==","boolean",e);i=i?Container.createSimpleBinaryExpression(i,r,$data.Expressions.ExpressionType.Or,"||","boolean",f):r}),u=t.data,t.data="",this.Visit(i,t),t.data=u+t.data.replace(/\(/g,"").replace(/\)/g,"")}else this.Visit(n.left,t),t.data+=" ",t.data+=n.resolution.mapTo,t.data+=" ",this.Visit(n.right,t);t.data+=")"},VisitEntityFieldExpression:function(n,t){this.Visit(n.source,t),n.source instanceof $data.Expressions.ComplexTypeExpression&&(t.data+="/"),this.Visit(n.selector,t)},VisitAssociationInfoExpression:function(n,t){t.data+=n.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(n,t){t.data+=n.memberName},VisitQueryParameterExpression:function(n,t){t.data+=this.provider.fieldConverter.toDb[n.type](n.value)},VisitEntityFieldOperationExpression:function(n,t){var i,r;Guard.requireType("expression.operation",n.operation,$data.Expressions.MemberInfoExpression),i=n.operation.memberDefinition,r=i.mapTo||i.name,t.data+=r,t.data+="(";var u=0,f=i.parameters||[{name:"@expression"}],e=f.map(function(t){return t.name==="@expression"?n.source:n.parameters[u++]});e.forEach(function(n,i){i>0&&(t.data+=","),this.Visit(n,t)},this),t.data+=")"},VisitConstantExpression:function(n,t){var i=Container.getTypeName(n.value);t.data+=this.provider.fieldConverter.toDb[Container.resolveName(Container.resolveType(i))](n.value)},VisitEntityExpression:function(n,t){this.Visit(n.source,t),this.lambdaPrefix&&n.selector.lambda&&(t.lambda=n.selector.lambda,t.data+=n.selector.lambda+"/")},VisitEntitySetExpression:function(n,t){this.Visit(n.source,t),n.selector instanceof $data.Expressions.AssociationInfoExpression&&(this.Visit(n.selector,t),t.data+="/")},VisitFrameOperationExpression:function(n,t){var i,e,u,r;this.Visit(n.source,t),Guard.requireType("expression.operation",n.operation,$data.Expressions.MemberInfoExpression),i=n.operation.memberDefinition,e=i.mapTo||i.name,t.data+=e,t.data+="(";var s=0,h=i.parameters||[{name:"@expression"}],o=h.map(function(t){return t.name==="@expression"?n.source:n.parameters[s++]});for(u=0;u<o.length;u++)if(r=o[u],r&&r.value instanceof $data.Queryable){var c=new i.frameType(r.value.expression),l=Container.createQueryExpressionCreator(r.value.entityContext),a=l.Visit(c),v=new $data.storageProviders.oData.oDataWhereCompiler(this.provider,!0),f={data:""},y=v.compile(a,f);t.data+=f.lambda+": "+f.data}t.data+=")"}}),$C("$data.storageProviders.oData.oDataOrderCompiler",$data.storageProviders.oData.oDataWhereCompiler,null,{constructor:function(n){this.provider=n},compile:function(n,t){this.Visit(n,t)},VisitOrderExpression:function(n,t){var i={data:""};this.Visit(n.selector,i),t.$orderby?t.$orderby+=",":t.$orderby="",t.$orderby+=i.data+(n.nodeType==$data.Expressions.ExpressionType.OrderByDescending?" desc":"")},VisitParametricQueryExpression:function(n,t){this.Visit(n.expression,t)},VisitEntityFieldExpression:function(n,t){this.Visit(n.source,t),this.Visit(n.selector,t)},VisitComplexTypeExpression:function(n,t){this.Visit(n.source,t),this.Visit(n.selector,t),t.data+="/"},VisitEntitySetExpression:function(n,t){n.selector instanceof $data.Expressions.AssociationInfoExpression&&(this.Visit(n.source,t),this.Visit(n.selector,t))},VisitAssociationInfoExpression:function(n,t){t.data+=n.associationInfo.FromPropertyName+"/"},VisitEntityExpression:function(n,t){this.Visit(n.source,t),this.Visit(n.selector,t)},VisitMemberInfoExpression:function(n,t){t.data+=n.memberName}}),$C("$data.storageProviders.oData.oDataPagingCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(n){this.provider=n},compile:function(n,t){this.Visit(n,t)},VisitPagingExpression:function(n,t){var i={data:""};this.Visit(n.amount,i);switch(n.nodeType){case $data.Expressions.ExpressionType.Skip:t.$skip=i.data;break;case $data.Expressions.ExpressionType.Take:t.$top=i.data;break;default:Guard.raise("Not supported nodeType")}},VisitConstantExpression:function(n,t){t.data+=n.value}}),$C("$data.storageProviders.oData.oDataProjectionCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(n){this.entityContext=n,this.hasObjectLiteral=!1,this.ObjectLiteralPath="",this.modelBinderMapping=[]},compile:function(n,t){this.Visit(n,t)},VisitProjectionExpression:function(n,t){t.data="",this.mapping="",this.Visit(n.selector,t),t.$select?t.$select+=",":t.$select="",t.$select+=t.data,t.data=""},VisitParametricQueryExpression:function(n,t){var i;this.Visit(n.expression,t),(n.expression instanceof $data.Expressions.EntityExpression||n.expression instanceof $data.Expressions.EntitySetExpression)&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=this.mapping.replace(/\./g,"/")),n.expression instanceof $data.Expressions.ComplexTypeExpression?(i=this.mapping.split("."),i.pop(),i.length>0&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=i.join("/"))):(i=this.mapping.split("."),i.pop(),i.length>0&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=i.join("/")))},VisitObjectLiteralExpression:function(n,t){var i=this.ObjectLiteralPath;this.hasObjectLiteral=!0,n.members.forEach(function(i,r){this.Visit(i,t),r<n.members.length-1&&(t.data+=","),this.mapping=""},this),this.ObjectLiteralPath=i},VisitObjectFieldExpression:function(n,t){if(this.ObjectLiteralPath?this.ObjectLiteralPath+="."+n.fieldName:this.ObjectLiteralPath=n.fieldName,this.Visit(n.expression,t),n.expression instanceof $data.Expressions.EntityExpression||n.expression instanceof $data.Expressions.EntitySetExpression)t.$expand?t.$expand+=",":t.$expand="",t.$expand+=this.mapping.replace(/\./g,"/");else{var i=this.mapping.split(".");i.pop(),i.length>0&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=i.join("/"))}},VisitComplexTypeExpression:function(n,t){this.Visit(n.source,t),this.Visit(n.selector,t)},VisitEntityFieldExpression:function(n,t){this.Visit(n.source,t),this.Visit(n.selector,t)},VisitEntityExpression:function(n,t){this.Visit(n.source,t)},VisitEntitySetExpression:function(n,t){n.source instanceof $data.Expressions.EntityExpression&&this.Visit(n.source,t),n.selector instanceof $data.Expressions.AssociationInfoExpression&&this.Visit(n.selector,t)},VisitAssociationInfoExpression:function(n,t){t.data&&t.data.length>0&&t.data[t.data.length-1]!=","&&(t.data+="/"),t.data+=n.associationInfo.FromPropertyName,this.mapping&&this.mapping.length>0&&(this.mapping+="."),this.mapping+=n.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(n,t){t.data&&t.data.length>0&&t.data[t.data.length-1]!=","&&(t.data+="/"),t.data+=n.memberName,this.mapping&&this.mapping.length>0&&(this.mapping+="."),this.mapping+=n.memberName},VisitConstantExpression:function(n,t){t.data=t.data.slice(0,t.data.length-1)}});
//@ sourceMappingURL=WebApiProvider.min.js.map